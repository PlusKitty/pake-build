name: Build Pake App

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'App name'
        required: true
      title:
        description: 'App title/slug'
        required: true
      url:
        description: 'Target URL'
        required: true
      platform:
        description: 'Target platform'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - windows
          - macos
          - linux
      json_config:
        description: 'Full Configuration (JSON)'
        required: true
        default: '{}'

jobs:
  build-windows:
    if: inputs.platform == 'windows' || inputs.platform == 'all'
    runs-on: windows-latest
    steps:
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - uses: dtolnay/rust-toolchain@stable
      - uses: Swatinem/rust-cache@v2
      - uses: actions/cache@v4
        with:
          path: ~/AppData/Local/npm-cache
          key: ${{ runner.os }}-npm-pake
          restore-keys: ${{ runner.os }}-npm-pake
      - run: npm install -g pake-cli
      - uses: actions/checkout@v4
      - name: Build app
        env:
          JSON_CONFIG: ${{ inputs.json_config }}
        run: |
          echo "CmNvbnN0IHsgZXhlY1N5bmMgfSA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTsKY29uc3QgZnMgPSByZXF1aXJlKCdmcycpOwpjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpOwoKdHJ5IHsKICBjb25zdCBjb25maWcgPSBKU09OLnBhcnNlKHByb2Nlc3MuZW52LkpTT05fQ09ORklHKTsKICAKICAvLyBDb25zdHJ1Y3QgYXJndW1lbnRzCiAgLy8gUGFrZSBleHBlY3RzOiBwYWtlIHVybCAtLW5hbWUgbmFtZSBbb3B0aW9uc10KICBsZXQgY21kID0gYHBha2UgIiR7Y29uZmlnLnVybH0iIC0tbmFtZSAiJHtjb25maWcubmFtZS5yZXBsYWNlKC8iL2csICdcIicpfSJgOwogIAogIC8vIENoZWNrIGZvciBsb2NhbCBpY29uCiAgaWYgKGZzLmV4aXN0c1N5bmMoJ2ljb24ucG5nJykpIHsKICAgIGNtZCArPSAnIC0taWNvbiBpY29uLnBuZyc7CiAgfSBlbHNlIGlmIChjb25maWcuaWNvbikgewogICAgY21kICs9IGAgLS1pY29uICIke2NvbmZpZy5pY29ufSJgOwogIH0KICAKICAvLyBNYXAgc2ltcGxlIHZhbHVlIG9wdGlvbnMKICBjb25zdCB2YWx1ZU9wdGlvbnMgPSB7CiAgICAnd2lkdGgnOiAnLS13aWR0aCcsCiAgICAnaGVpZ2h0JzogJy0taGVpZ2h0JywKICAgICd1c2VyX2FnZW50JzogJy0tdXNlci1hZ2VudCcsCiAgICAnem9vbSc6ICctLXpvb20nLAogICAgJ2FwcF92ZXJzaW9uJzogJy0tYXBwLXZlcnNpb24nLAogICAgJ3dpbmRvd190aXRsZSc6ICctLXRpdGxlJywKICAgICdhY3RpdmF0aW9uX3Nob3J0Y3V0JzogJy0tYWN0aXZhdGlvbi1zaG9ydGN1dCcsCiAgICAnbWluX3dpZHRoJzogJy0tbWluLXdpZHRoJywKICAgICdtaW5faGVpZ2h0JzogJy0tbWluLWhlaWdodCcsCiAgICAncHJveHlfdXJsJzogJy0tcHJveHktdXJsJywKICAgICd0cmF5X2ljb24nOiAnLS1zeXN0ZW0tdHJheS1pY29uJywKICAgICdpbnN0YWxsZXJfbGFuZ3VhZ2UnOiAnLS1pbnN0YWxsZXItbGFuZ3VhZ2UnCiAgfTsKICAKICBmb3IgKGNvbnN0IFtrZXksIGZsYWddIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlT3B0aW9ucykpIHsKICAgIGlmIChjb25maWdba2V5XSkgewogICAgICBjbWQgKz0gYCAke2ZsYWd9ICIke1N0cmluZyhjb25maWdba2V5XSkucmVwbGFjZSgvIi9nLCAnXCInKX0iYDsKICAgIH0KICB9CiAgCiAgLy8gTWFwIGJvb2xlYW4gb3B0aW9ucwogIGNvbnN0IGJvb2xPcHRpb25zID0gewogICAgJ2Z1bGxzY3JlZW4nOiAnLS1mdWxsc2NyZWVuJywKICAgICdhbHdheXNfb25fdG9wJzogJy0tYWx3YXlzLW9uLXRvcCcsCiAgICAnaGlkZV90aXRsZV9iYXInOiAnLS1oaWRlLXRpdGxlLWJhcicsCiAgICAnc2hvd19zeXN0ZW1fdHJheSc6ICctLXNob3ctc3lzdGVtLXRyYXknLAogICAgJ211bHRpX2FyY2gnOiAnLS1tdWx0aS1hcmNoJywKICAgICdtdWx0aV9pbnN0YW5jZSc6ICctLW11bHRpLWluc3RhbmNlJywKICAgICdlbmFibGVfZHJhZ19kcm9wJzogJy0tZW5hYmxlLWRyYWctZHJvcCcsCiAgICAnd2FzbSc6ICctLXdhc20nLAogICAgJ2RlYnVnJzogJy0tZGVidWcnLAogICAgJ2lnbm9yZV9jZXJ0aWZpY2F0ZV9lcnJvcnMnOiAnLS1pZ25vcmUtY2VydGlmaWNhdGUtZXJyb3JzJywKICAgICdtYXhpbWl6ZSc6ICctLW1heGltaXplJywKICAgICdpbmNvZ25pdG8nOiAnLS1pbmNvZ25pdG8nLAogICAgJ2ZvcmNlX2ludGVybmFsX25hdmlnYXRpb24nOiAnLS1mb3JjZS1pbnRlcm5hbC1uYXZpZ2F0aW9uJywKICAgICdkaXNhYmxlZF93ZWJfc2hvcnRjdXRzJzogJy0tZGlzYWJsZWQtd2ViLXNob3J0Y3V0cycsCiAgICAnZGFya19tb2RlJzogJy0tZGFyay1tb2RlJywKICAgICdoaWRlX29uX2Nsb3NlJzogJy0taGlkZS1vbi1jbG9zZScsCiAgICAnc3RhcnRfdG9fdHJheSc6ICctLXN0YXJ0LXRvLXRyYXknCiAgfTsKICAKICBmb3IgKGNvbnN0IFtrZXksIGZsYWddIG9mIE9iamVjdC5lbnRyaWVzKGJvb2xPcHRpb25zKSkgewogICAgaWYgKGNvbmZpZ1trZXldID09PSB0cnVlIHx8IGNvbmZpZ1trZXldID09PSAndHJ1ZScpIHsKICAgICAgY21kICs9IGAgJHtmbGFnfWA7CiAgICB9CiAgfQogIAogIC8vIEluamVjdCBDU1MvSlMKICBpZiAoY29uZmlnLmluamVjdF9jc3MpIHsKICAgIGZzLndyaXRlRmlsZVN5bmMoJ2luamVjdC5jc3MnLCBjb25maWcuaW5qZWN0X2Nzcyk7CiAgICBjbWQgKz0gJyAtLWluamVjdCBpbmplY3QuY3NzJzsKICB9CiAgaWYgKGNvbmZpZy5pbmplY3RfanMpIHsKICAgIGZzLndyaXRlRmlsZVN5bmMoJ2luamVjdC5qcycsIGNvbmZpZy5pbmplY3RfanMpOwogICAgY21kICs9ICcgLS1pbmplY3QgaW5qZWN0LmpzJzsKICB9CiAgCiAgY29uc29sZS5sb2coJ0V4ZWN1dGluZyBQYWtlIGNvbW1hbmQuLi4nKTsKICAvLyBFeGVjdXRlIHZpYSBzaGVsbCB0byBoYW5kbGUgdGhlIGNvbW1hbmQgc3RyaW5nCiAgZXhlY1N5bmMoY21kLCB7IHN0ZGlvOiAnaW5oZXJpdCcgfSk7CiAgCn0gY2F0Y2ggKGUpIHsKICBjb25zb2xlLmVycm9yKCdCdWlsZCBzY3JpcHQgZmFpbGVkOicsIGUpOwogIHByb2Nlc3MuZXhpdCgxKTsKfQo=" > build_script.js_b64
          certutil -decode build_script.js_b64 build_script.js
          node build_script.js
      - uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.title }}-windows
          path: |
            *.exe
            *.msi
            **/*.msi
            **/*.exe
          if-no-files-found: warn

  build-macos:
    if: inputs.platform == 'macos' || inputs.platform == 'all'
    runs-on: macos-latest
    steps:
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - uses: dtolnay/rust-toolchain@stable
      - uses: Swatinem/rust-cache@v2
      - uses: actions/cache@v4
        with:
          path: ~/.npm
          key: ${{ runner.os }}-npm-pake
          restore-keys: ${{ runner.os }}-npm-pake
      - run: npm install -g pake-cli
      - uses: actions/checkout@v4
      - name: Build app
        env:
          JSON_CONFIG: ${{ inputs.json_config }}
        run: |
          echo "CmNvbnN0IHsgZXhlY1N5bmMgfSA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTsKY29uc3QgZnMgPSByZXF1aXJlKCdmcycpOwpjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpOwoKdHJ5IHsKICBjb25zdCBjb25maWcgPSBKU09OLnBhcnNlKHByb2Nlc3MuZW52LkpTT05fQ09ORklHKTsKICAKICAvLyBDb25zdHJ1Y3QgYXJndW1lbnRzCiAgLy8gUGFrZSBleHBlY3RzOiBwYWtlIHVybCAtLW5hbWUgbmFtZSBbb3B0aW9uc10KICBsZXQgY21kID0gYHBha2UgIiR7Y29uZmlnLnVybH0iIC0tbmFtZSAiJHtjb25maWcubmFtZS5yZXBsYWNlKC8iL2csICdcIicpfSJgOwogIAogIC8vIENoZWNrIGZvciBsb2NhbCBpY29uCiAgaWYgKGZzLmV4aXN0c1N5bmMoJ2ljb24ucG5nJykpIHsKICAgIGNtZCArPSAnIC0taWNvbiBpY29uLnBuZyc7CiAgfSBlbHNlIGlmIChjb25maWcuaWNvbikgewogICAgY21kICs9IGAgLS1pY29uICIke2NvbmZpZy5pY29ufSJgOwogIH0KICAKICAvLyBNYXAgc2ltcGxlIHZhbHVlIG9wdGlvbnMKICBjb25zdCB2YWx1ZU9wdGlvbnMgPSB7CiAgICAnd2lkdGgnOiAnLS13aWR0aCcsCiAgICAnaGVpZ2h0JzogJy0taGVpZ2h0JywKICAgICd1c2VyX2FnZW50JzogJy0tdXNlci1hZ2VudCcsCiAgICAnem9vbSc6ICctLXpvb20nLAogICAgJ2FwcF92ZXJzaW9uJzogJy0tYXBwLXZlcnNpb24nLAogICAgJ3dpbmRvd190aXRsZSc6ICctLXRpdGxlJywKICAgICdhY3RpdmF0aW9uX3Nob3J0Y3V0JzogJy0tYWN0aXZhdGlvbi1zaG9ydGN1dCcsCiAgICAnbWluX3dpZHRoJzogJy0tbWluLXdpZHRoJywKICAgICdtaW5faGVpZ2h0JzogJy0tbWluLWhlaWdodCcsCiAgICAncHJveHlfdXJsJzogJy0tcHJveHktdXJsJywKICAgICd0cmF5X2ljb24nOiAnLS1zeXN0ZW0tdHJheS1pY29uJywKICAgICdpbnN0YWxsZXJfbGFuZ3VhZ2UnOiAnLS1pbnN0YWxsZXItbGFuZ3VhZ2UnCiAgfTsKICAKICBmb3IgKGNvbnN0IFtrZXksIGZsYWddIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlT3B0aW9ucykpIHsKICAgIGlmIChjb25maWdba2V5XSkgewogICAgICBjbWQgKz0gYCAke2ZsYWd9ICIke1N0cmluZyhjb25maWdba2V5XSkucmVwbGFjZSgvIi9nLCAnXCInKX0iYDsKICAgIH0KICB9CiAgCiAgLy8gTWFwIGJvb2xlYW4gb3B0aW9ucwogIGNvbnN0IGJvb2xPcHRpb25zID0gewogICAgJ2Z1bGxzY3JlZW4nOiAnLS1mdWxsc2NyZWVuJywKICAgICdhbHdheXNfb25fdG9wJzogJy0tYWx3YXlzLW9uLXRvcCcsCiAgICAnaGlkZV90aXRsZV9iYXInOiAnLS1oaWRlLXRpdGxlLWJhcicsCiAgICAnc2hvd19zeXN0ZW1fdHJheSc6ICctLXNob3ctc3lzdGVtLXRyYXknLAogICAgJ211bHRpX2FyY2gnOiAnLS1tdWx0aS1hcmNoJywKICAgICdtdWx0aV9pbnN0YW5jZSc6ICctLW11bHRpLWluc3RhbmNlJywKICAgICdlbmFibGVfZHJhZ19kcm9wJzogJy0tZW5hYmxlLWRyYWctZHJvcCcsCiAgICAnd2FzbSc6ICctLXdhc20nLAogICAgJ2RlYnVnJzogJy0tZGVidWcnLAogICAgJ2lnbm9yZV9jZXJ0aWZpY2F0ZV9lcnJvcnMnOiAnLS1pZ25vcmUtY2VydGlmaWNhdGUtZXJyb3JzJywKICAgICdtYXhpbWl6ZSc6ICctLW1heGltaXplJywKICAgICdpbmNvZ25pdG8nOiAnLS1pbmNvZ25pdG8nLAogICAgJ2ZvcmNlX2ludGVybmFsX25hdmlnYXRpb24nOiAnLS1mb3JjZS1pbnRlcm5hbC1uYXZpZ2F0aW9uJywKICAgICdkaXNhYmxlZF93ZWJfc2hvcnRjdXRzJzogJy0tZGlzYWJsZWQtd2ViLXNob3J0Y3V0cycsCiAgICAnZGFya19tb2RlJzogJy0tZGFyay1tb2RlJywKICAgICdoaWRlX29uX2Nsb3NlJzogJy0taGlkZS1vbi1jbG9zZScsCiAgICAnc3RhcnRfdG9fdHJheSc6ICctLXN0YXJ0LXRvLXRyYXknCiAgfTsKICAKICBmb3IgKGNvbnN0IFtrZXksIGZsYWddIG9mIE9iamVjdC5lbnRyaWVzKGJvb2xPcHRpb25zKSkgewogICAgaWYgKGNvbmZpZ1trZXldID09PSB0cnVlIHx8IGNvbmZpZ1trZXldID09PSAndHJ1ZScpIHsKICAgICAgY21kICs9IGAgJHtmbGFnfWA7CiAgICB9CiAgfQogIAogIC8vIEluamVjdCBDU1MvSlMKICBpZiAoY29uZmlnLmluamVjdF9jc3MpIHsKICAgIGZzLndyaXRlRmlsZVN5bmMoJ2luamVjdC5jc3MnLCBjb25maWcuaW5qZWN0X2Nzcyk7CiAgICBjbWQgKz0gJyAtLWluamVjdCBpbmplY3QuY3NzJzsKICB9CiAgaWYgKGNvbmZpZy5pbmplY3RfanMpIHsKICAgIGZzLndyaXRlRmlsZVN5bmMoJ2luamVjdC5qcycsIGNvbmZpZy5pbmplY3RfanMpOwogICAgY21kICs9ICcgLS1pbmplY3QgaW5qZWN0LmpzJzsKICB9CiAgCiAgY29uc29sZS5sb2coJ0V4ZWN1dGluZyBQYWtlIGNvbW1hbmQuLi4nKTsKICAvLyBFeGVjdXRlIHZpYSBzaGVsbCB0byBoYW5kbGUgdGhlIGNvbW1hbmQgc3RyaW5nCiAgZXhlY1N5bmMoY21kLCB7IHN0ZGlvOiAnaW5oZXJpdCcgfSk7CiAgCn0gY2F0Y2ggKGUpIHsKICBjb25zb2xlLmVycm9yKCdCdWlsZCBzY3JpcHQgZmFpbGVkOicsIGUpOwogIHByb2Nlc3MuZXhpdCgxKTsKfQo=" | base64 -d > build_script.js
          node build_script.js
      - uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.title }}-macos
          path: |
            *.dmg
            *.app
            **/*.dmg
            **/*.app
          if-no-files-found: warn

  build-linux:
    if: inputs.platform == 'linux' || inputs.platform == 'all'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - uses: dtolnay/rust-toolchain@stable
      - uses: Swatinem/rust-cache@v2
      - uses: actions/cache@v4
        with:
          path: ~/.npm
          key: ${{ runner.os }}-npm-pake
          restore-keys: ${{ runner.os }}-npm-pake
      - run: npm install -g pake-cli
      - run: |
          sudo apt-get update
          sudo apt-get install -y libwebkit2gtk-4.1-dev libappindicator3-dev librsvg2-dev patchelf
      - uses: actions/checkout@v4
      - name: Build app
        env:
          JSON_CONFIG: ${{ inputs.json_config }}
        run: |
          echo "CmNvbnN0IHsgZXhlY1N5bmMgfSA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTsKY29uc3QgZnMgPSByZXF1aXJlKCdmcycpOwpjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpOwoKdHJ5IHsKICBjb25zdCBjb25maWcgPSBKU09OLnBhcnNlKHByb2Nlc3MuZW52LkpTT05fQ09ORklHKTsKICAKICAvLyBDb25zdHJ1Y3QgYXJndW1lbnRzCiAgLy8gUGFrZSBleHBlY3RzOiBwYWtlIHVybCAtLW5hbWUgbmFtZSBbb3B0aW9uc10KICBsZXQgY21kID0gYHBha2UgIiR7Y29uZmlnLnVybH0iIC0tbmFtZSAiJHtjb25maWcubmFtZS5yZXBsYWNlKC8iL2csICdcIicpfSJgOwogIAogIC8vIENoZWNrIGZvciBsb2NhbCBpY29uCiAgaWYgKGZzLmV4aXN0c1N5bmMoJ2ljb24ucG5nJykpIHsKICAgIGNtZCArPSAnIC0taWNvbiBpY29uLnBuZyc7CiAgfSBlbHNlIGlmIChjb25maWcuaWNvbikgewogICAgY21kICs9IGAgLS1pY29uICIke2NvbmZpZy5pY29ufSJgOwogIH0KICAKICAvLyBNYXAgc2ltcGxlIHZhbHVlIG9wdGlvbnMKICBjb25zdCB2YWx1ZU9wdGlvbnMgPSB7CiAgICAnd2lkdGgnOiAnLS13aWR0aCcsCiAgICAnaGVpZ2h0JzogJy0taGVpZ2h0JywKICAgICd1c2VyX2FnZW50JzogJy0tdXNlci1hZ2VudCcsCiAgICAnem9vbSc6ICctLXpvb20nLAogICAgJ2FwcF92ZXJzaW9uJzogJy0tYXBwLXZlcnNpb24nLAogICAgJ3dpbmRvd190aXRsZSc6ICctLXRpdGxlJywKICAgICdhY3RpdmF0aW9uX3Nob3J0Y3V0JzogJy0tYWN0aXZhdGlvbi1zaG9ydGN1dCcsCiAgICAnbWluX3dpZHRoJzogJy0tbWluLXdpZHRoJywKICAgICdtaW5faGVpZ2h0JzogJy0tbWluLWhlaWdodCcsCiAgICAncHJveHlfdXJsJzogJy0tcHJveHktdXJsJywKICAgICd0cmF5X2ljb24nOiAnLS1zeXN0ZW0tdHJheS1pY29uJywKICAgICdpbnN0YWxsZXJfbGFuZ3VhZ2UnOiAnLS1pbnN0YWxsZXItbGFuZ3VhZ2UnCiAgfTsKICAKICBmb3IgKGNvbnN0IFtrZXksIGZsYWddIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlT3B0aW9ucykpIHsKICAgIGlmIChjb25maWdba2V5XSkgewogICAgICBjbWQgKz0gYCAke2ZsYWd9ICIke1N0cmluZyhjb25maWdba2V5XSkucmVwbGFjZSgvIi9nLCAnXCInKX0iYDsKICAgIH0KICB9CiAgCiAgLy8gTWFwIGJvb2xlYW4gb3B0aW9ucwogIGNvbnN0IGJvb2xPcHRpb25zID0gewogICAgJ2Z1bGxzY3JlZW4nOiAnLS1mdWxsc2NyZWVuJywKICAgICdhbHdheXNfb25fdG9wJzogJy0tYWx3YXlzLW9uLXRvcCcsCiAgICAnaGlkZV90aXRsZV9iYXInOiAnLS1oaWRlLXRpdGxlLWJhcicsCiAgICAnc2hvd19zeXN0ZW1fdHJheSc6ICctLXNob3ctc3lzdGVtLXRyYXknLAogICAgJ211bHRpX2FyY2gnOiAnLS1tdWx0aS1hcmNoJywKICAgICdtdWx0aV9pbnN0YW5jZSc6ICctLW11bHRpLWluc3RhbmNlJywKICAgICdlbmFibGVfZHJhZ19kcm9wJzogJy0tZW5hYmxlLWRyYWctZHJvcCcsCiAgICAnd2FzbSc6ICctLXdhc20nLAogICAgJ2RlYnVnJzogJy0tZGVidWcnLAogICAgJ2lnbm9yZV9jZXJ0aWZpY2F0ZV9lcnJvcnMnOiAnLS1pZ25vcmUtY2VydGlmaWNhdGUtZXJyb3JzJywKICAgICdtYXhpbWl6ZSc6ICctLW1heGltaXplJywKICAgICdpbmNvZ25pdG8nOiAnLS1pbmNvZ25pdG8nLAogICAgJ2ZvcmNlX2ludGVybmFsX25hdmlnYXRpb24nOiAnLS1mb3JjZS1pbnRlcm5hbC1uYXZpZ2F0aW9uJywKICAgICdkaXNhYmxlZF93ZWJfc2hvcnRjdXRzJzogJy0tZGlzYWJsZWQtd2ViLXNob3J0Y3V0cycsCiAgICAnZGFya19tb2RlJzogJy0tZGFyay1tb2RlJywKICAgICdoaWRlX29uX2Nsb3NlJzogJy0taGlkZS1vbi1jbG9zZScsCiAgICAnc3RhcnRfdG9fdHJheSc6ICctLXN0YXJ0LXRvLXRyYXknCiAgfTsKICAKICBmb3IgKGNvbnN0IFtrZXksIGZsYWddIG9mIE9iamVjdC5lbnRyaWVzKGJvb2xPcHRpb25zKSkgewogICAgaWYgKGNvbmZpZ1trZXldID09PSB0cnVlIHx8IGNvbmZpZ1trZXldID09PSAndHJ1ZScpIHsKICAgICAgY21kICs9IGAgJHtmbGFnfWA7CiAgICB9CiAgfQogIAogIC8vIEluamVjdCBDU1MvSlMKICBpZiAoY29uZmlnLmluamVjdF9jc3MpIHsKICAgIGZzLndyaXRlRmlsZVN5bmMoJ2luamVjdC5jc3MnLCBjb25maWcuaW5qZWN0X2Nzcyk7CiAgICBjbWQgKz0gJyAtLWluamVjdCBpbmplY3QuY3NzJzsKICB9CiAgaWYgKGNvbmZpZy5pbmplY3RfanMpIHsKICAgIGZzLndyaXRlRmlsZVN5bmMoJ2luamVjdC5qcycsIGNvbmZpZy5pbmplY3RfanMpOwogICAgY21kICs9ICcgLS1pbmplY3QgaW5qZWN0LmpzJzsKICB9CiAgCiAgY29uc29sZS5sb2coJ0V4ZWN1dGluZyBQYWtlIGNvbW1hbmQuLi4nKTsKICAvLyBFeGVjdXRlIHZpYSBzaGVsbCB0byBoYW5kbGUgdGhlIGNvbW1hbmQgc3RyaW5nCiAgZXhlY1N5bmMoY21kLCB7IHN0ZGlvOiAnaW5oZXJpdCcgfSk7CiAgCn0gY2F0Y2ggKGUpIHsKICBjb25zb2xlLmVycm9yKCdCdWlsZCBzY3JpcHQgZmFpbGVkOicsIGUpOwogIHByb2Nlc3MuZXhpdCgxKTsKfQo=" | base64 -d > build_script.js
          node build_script.js
      - uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.title }}-linux
          path: |
            *.deb
            *.AppImage
            **/*.deb
            **/*.AppImage
          if-no-files-found: warn
